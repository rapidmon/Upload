<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SNS 예약 전송 프로그램</title>
    <link rel="icon" href="https://image.donga.com/pc/2022/images/common/favicon.ico">
    <link rel="stylesheet" href="./index.css">
    <link rel="stylesheet" href="./reset.css">
</head>
<body>
    <form id="submitForm">
        <fieldset>
            <legend>SNS 업로드 예약</legend>
            <div>
                <label>기사 요약문</label><input type="text" placeholder="기사 요약" name="summary" id="summary">
                <p id="summaryError"></p>
            </div>
            <div>
                <label>기사 링크</label><input type="url" placeholder="링크" name="link" id="link">
                <p id="linkError"></p>
            </div>
            <div>
                <label>업로드 시간</label><input type="datetime-local" name="schedule" id="schedule">
                <p id="scheduleError"></p>
            </div>
            <div>
                <label>보안 코드</label><input type="text" placeholder="입력 코드" name="code" id="code">
                <p id="codeError"></p>
            </div>
            <div>
                <input type="button" value="submit" id="submitBtn">
            </div>
        </fieldset>
    </form>
    <ul class="reserve-list">
        <li class="get-reserve-list">
            <button class="get-reserve-list-btn">예약 목록 불러오기</button>
        </li>
        <li class="reserve">
            <p class="reserve-summary">기사 요약</p>
            <p class="reserve-link">기사 링크</p>
            <p class="reserve-time">예약 시간</p>
            <p class="delete-btn">편집</p>
        </li>
        <li class="reserve">
            <p class="reserve-summary">어쩌고저쩌고</p>
            <p class="reserve-link">링크</p>
            <p class="reserve-time">시간</p>
            <button class="delete-btn">삭제</button>
        </li>
    </ul>
</body>
<script>
    const submitBtn = document.getElementById('submitBtn');

    submitBtn.addEventListener('click', async function() {
        const summary = document.getElementById('summary');
        const link = document.getElementById('link');
        const schedule = document.getElementById('schedule');
        const code = document.getElementById('code');
        let isValid = true;
        
        // 오류 메시지 초기화
        document.getElementById('summaryError').textContent = '';
        document.getElementById('linkError').textContent = '';
        document.getElementById('scheduleError').textContent = '';
        document.getElementById('codeError').textContent = '';

        // 입력 필드 비활성화
        summary.disabled = true;
        link.disabled = true;
        schedule.disabled = true;
        code.disabled = true;
        
        // 기사 요약문 검증
        if (!summary.value.trim()) {
            document.getElementById('summaryError').textContent = '기사 요약문을 입력해주세요.';
            isValid = false;
        }
        
        // 기사 링크 검증 (URL 형식)
        if (!link.value.trim() || !/^https?:\/\/.+/i.test(link.value)) {
            document.getElementById('linkError').textContent = '올바른 링크 형식을 입력해주세요.';
            isValid = false;
        }
        
        // 업로드 시간 검증
        if (!schedule.value.trim()) {
            document.getElementById('scheduleError').textContent = '업로드 시간을 설정해주세요.';
            isValid = false;
        }
        
        // 보안 코드 검증
        if (!code.value.trim()) {
            document.getElementById('codeError').textContent = '보안 코드를 입력해주세요.';
            isValid = false;
        }
        
        if (!isValid) {
            // 유효성 검사 실패 시, 입력 필드 다시 활성화
            summary.disabled = false;
            link.disabled = false;
            schedule.disabled = false;
            code.disabled = false;
            return; // API 호출 중단
        }

        // 버튼 비활성화
        submitBtn.disabled = true;

        // API Gateway 엔드포인트로 전송할 데이터 객체
        const tweetData = {
            summary: summary.value,
            link: link.value,
            schedule: schedule.value,
            code: code.value
        };
    
        // API Gateway 엔드포인트 URL
        const apiEndpoint = 'https://nu0ww2fb5l.execute-api.ap-southeast-2.amazonaws.com/Stage/tweet';
    
        try {
            // Fetch API를 사용하여 데이터 전송
            const response = await fetch(apiEndpoint, {
                method: 'POST',
                body: JSON.stringify(tweetData),
                headers: {
                    'Content-Type': 'application/json'
                }
            });
    
            if (response.ok) {
                console.log('News scheduled successfully');
                alert('기사가 예약되었습니다!');
            } else {
                console.error('Failed to schedule News');
                console.log(response);
                alert('기사 예약에 실패했습니다. 보안 코드를 확인해주세요');
            }
        } catch (error) {
            console.error('Error:', error);
            alert('기사 예약 중 에러가 발생했습니다.');
        } finally {
            // 입력 필드 다시 활성화 및 초기화
            summary.value = '';
            link.value = '';
            schedule.value = '';
            code.value = '';
            summary.disabled = false;
            link.disabled = false;
            schedule.disabled = false;
            code.disabled = false;
            submitBtn.disabled = false;
        }
    });
</script>
</html>